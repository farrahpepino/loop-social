<app-navigation />

<button class="mb" (click)="viewForm()">
    +
</button>

<div class="post-wrapper content">
<div class="post-container" *ngFor="let post of posts" >
   
    <div class="post-header">
        <div>
            <p class="f-300">{{post.username}}</p>
            <p class="f-100 st">{{post.createdAt | date: 'MMM d, y \'at\' h:mm a' }}</p>
        </div>
        <div *ngIf="post.username===loggedInUser?.username" class="bt parent menu">•••
            <button class="child-right white" (click)="deletePost(post.id)">DELETE POST</button>
        </div>
    </div>
    <p>{{post.content}}</p>
    <img
    *ngIf="post.imageUrl"
    [src]="post.imageUrl"
    alt="uploaded image"
    class="uploaded-img"> 
    <hr>
    <div class="react w-7rem">
        <div class="parent">
            <button type="button" class="bt" title="like" (click)="toggleLike(post)">
            <i 
            [ngClass]="isLiked(post.id) ? 'fa-solid fa-heart' : 'fa-regular fa-heart'" 
            [style.color]="isLiked(post.id) ? 'red' : 'rgb(0,0,0,0.5)'"
            >
            </i>
            </button>
            <div class="child"  *ngIf="post.likes && post.likes.length > 0">
                <div class="p-10" *ngFor="let like of post.likes">
                    <p class="white">{{like.username===loggedInUser?.username ? "You" : like.username}}</p>
                </div>
            </div>
        </div>
        <button class="bt" [style.color]="'rgba(0,0,0,0.5)'" (click)="viewPost(post.id)">
            <i class="fa-regular fa-comment" title="comment" ></i>
        </button>
    </div> 
</div>
</div>

<div class="backdrop" [class.hidden]="!showForm"></div>
<div class="post-block" [class.hidden]="!showForm">
    <div class="col">
        <div>
            <p class="f-300">{{loggedInUser?.username}}</p>
        </div>
        
        <button class="bt" (click)="hideForm()">X</button>
    </div>
    <div class="post-wrapper">
        <p 
          class="p-i"
          contenteditable="true"
          placeholder="Type something..."
          #postInput>
        </p>
      
        <div class="img-wrapper" *ngIf="previewUrl">
          <img [src]="previewUrl" alt="Uploaded image"/>
          <button type="button" (click)="unselectFile()">X</button>
        </div>
      
          <input
            type="file"
            id="fileInput"
            accept="image/*"
            (change)="onFileSelected($event)"
            hidden
          />
        <br>
    </div>
    <div class="post-div">
        <label for="fileInput" class="upload-label">
            <i class="fa fa-image big-icon"></i>
        </label>
        <button type="button" class="b" (click)="submitPost()">Post</button>
    </div>
</div>


<div class="backdrop" [class.hidden]="!showPost"></div>
<div class="post-block" [class.hidden]="!showPost" *ngIf="post">
    <div class="col">
        <div class="post-header">
            <div>
                <p class="f-300">{{post.username}}</p>
                <p class="f-100 st">{{post.createdAt | date: 'MMM d, y \'at\' h:mm a' }}</p>
            </div>
        </div>
        <div class="col">
            <div *ngIf="post.username===loggedInUser?.username" class="bt parent menu">•••
                <button class="child-right white" (click)="deletePost(post.id)">DELETE POST</button>
            </div>
            <button class="bt" (click)="hidePost()">X</button>
        </div>
    </div>
    <p>{{post.content}}</p>
    <img
    *ngIf="post.imageUrl"
    [src]="post.imageUrl"
    alt="uploaded image"
    class="uploaded-img"> 
    <hr>
    <div class="react w-7rem">
        <div class="parent">
            <button type="button" class="bt" title="like" (click)="toggleLike(post)">
            <i 
            [ngClass]="isLiked(post.id) ? 'fa-solid fa-heart' : 'fa-regular fa-heart'" 
            [style.color]="isLiked(post.id) ? 'red' : 'rgb(0,0,0,0.5)'"
            >
            </i>
            </button>
            <div class="child"  *ngIf="post.likes && post.likes.length > 0">
                <div class="p-10" *ngFor="let like of post.likes">
                    <p class="white">{{like.username===loggedInUser?.username ? "You" : like.username}}</p>
                </div>
            </div>
        </div>
    
        <p><i class="fa-regular fa-comment" title="comment" ></i>({{commentCount}})</p>
    </div> 
    <hr>
    <div class="comments-container">
        <div class="comment" *ngFor="let comment of comments"> 
            <div class="comment-content">
                <p class="f-300">{{comment.username}}</p>
                <p>{{comment.content}}</p>
                <p class="f-100 st">{{comment.createdAt | date: 'MMM d, y \'at\' h:mm a'}}</p>
            </div>
        </div>
    </div>  
    <div>
        <div class="brd">
        <p class="p-i" contenteditable="true" placeholder="Add a comment..."  #commentInput> </p>
        <button class="f-b" type="submit" (click)="submitComment(post.id)">post</button>
        </div>
    </div>
</div>
